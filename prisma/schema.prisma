generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TeamMember {
  id            String        @id @default(cuid())
  name          String
  email         String        @unique
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  opportunities Opportunity[]
}

enum Tier {
  HOT
  WARM
  COOL
  COLD
}

enum Status {
  NEW
  REVIEWING
  PURSUING
  PASSED
  WON
  LOST
}

enum Source {
  UTAH_BONFIRE
  STATE_BONFIRE
  BIDNET
  SAM_GOV
  WORLD_BANK
  UNGM
  UNDP
}

model Opportunity {
  id String @id @default(cuid())

  source    Source
  sourceId  String
  sourceUrl String?

  title       String
  description String? @db.Text
  issuingOrg  String?
  category    String?

  postedDate DateTime?
  deadline   DateTime?

  estimatedValue     Float?
  estimatedValueLow  Float?
  estimatedValueHigh Float?

  locationState   String?
  locationCity    String?
  locationCountry String  @default("USA")
  isUtah          Boolean @default(false)

  contactName  String?
  contactEmail String?
  contactPhone String?

  icpScore       Int?
  scoreBreakdown Json?
  tier           Tier?

  aiBrief       Json?
  aiGeneratedAt DateTime?

  keywordsMatched String[]

  status       Status      @default(NEW)
  decision     String?
  assignedTo   TeamMember? @relation(fields: [assignedToId], references: [id])
  assignedToId String?
  notes        String?     @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  rawData   Json?

  @@unique([source, sourceId])
  @@index([tier])
  @@index([status])
  @@index([deadline])
  @@index([isUtah])
}

model ScraperRun {
  id                 String    @id @default(cuid())
  source             Source
  startedAt          DateTime
  completedAt        DateTime?
  status             String
  opportunitiesFound Int       @default(0)
  opportunitiesNew   Int       @default(0)
  errorMessage       String?
}
